# Solar Production Simulator

A photovoltaic solar production simulator for residential systems that models household energy consumption and solar energy production, calculating the net energy balance in real-time.

## 📋 Overview

The project simulates a complete residential energy system consisting of:
- **Domestic energy meter**: generates realistic consumption data at regular intervals
- **Photovoltaic system**: simulates solar energy production with Gaussian patterns
- **Asynchronous communication system**: manages message exchange through RabbitMQ

The two components communicate in real-time, automatically calculating net energy (production - consumption) and saving all data for subsequent analysis.

## 🏗️ Architecture

The application is containerized with Docker Compose and consists of 3 main services:

### 🐰 RabbitMQ Broker (`rabbitmq`)
- **Container**: `rabbitmq`
- **Function**: Message broker for asynchronous communication between components
- **Technology**: Official RabbitMQ

### 📊 Meter Simulator (`meter_simulator`)
- **Container**: `producer`
- **Base Image**: `python:3.12.11-slim`
- **Architecture**: Implemented with Factory Method pattern for maximum extensibility
- **Value Generation**: Uses continuous variation algorithm with small random changes (±10% of current value, max ±0.5kW) to simulate realistic household consumption patterns
- **Features**: 
  - Generates energy consumption values every 2 seconds (in kW)
  - Allows to easily extend the meter simulator with new modules, in order to supports different building types (houses, industries, hospitals, etc...)
  - Currently configured to support only household consumption (random, but continuous, values produced in range 0.0 - 10.0 kW)
  - Maintains smooth transitions between readings for realistic data
  - Configurable through `config.py`

### ☀️ PV Simulator (`pv_simulator`)
- **Container**: `consumer`  
- **Base Image**: `python:3.12.11-slim`
- **Solar Production Model**: Implements realistic solar curve using pseudo Gaussian distribution with time-based peak generation at solar noon and zero in the night
- **Weather Simulation**: Adds randomness factor (0.3-1.2x) based on minute-level hash (that guarantee reproducibility) to simulate changing weather conditions. It is assumed that they can change every minute but remains constant for that entire minute. This simulates how real weather conditions change gradually but not instantaneously.
- **Features**:
  - Receives consumption data from RabbitMQ broker
  - Generates photovoltaic production values with bell-curve distribution (i.e: peak at 12:00, zero during night 19:00-06:00)
  - Calculates net energy balance (production - consumption) in kW
  - Saves results of a simulation to CSV files (use timestamp in epoch to make the file name unique)
  - Exports data to volume `./data`
  - Configurable through `config.py`

### 📈 Data Visualizer
The `plot_energy_data.py` script allows graphical visualization of simulation data:
- Accepts the path of a CSV file generated by the simulation
- Path must be relative to the `data/` folder
- Generates plots of consumption, production, and energy balance

## 📁 Output Data Structure

Generated CSV files contain the following columns:
- **timestamp**: Measurement time
- **meter_power_kw**: Household energy consumption
- **pv_power_kw**: Photovoltaic energy production
- **net_power_kw**: Net energy balance

## 🚀 Getting Started

### Prerequisites
- Docker
- Docker Compose

### Main Commands

**Clone the repository:**
1. Create the project folder:
```bash
mkdir PVSIMULATOR
cd PVSIMULATOR
```
2. Clone the repository inside the project folder


**Start the application:**
```bash
docker compose up
```

**Force rebuild containers:**
```bash
docker compose up --build
```

**Verify containers status:**
```bash
docker ps -a
```

**Stop and remove all containers:**
```bash
docker compose down
```

**View real-time logs:**
```bash
docker compose logs -f
```

## ⚙️ Configuration

Simulation parameters can be customized by modifying the `config.py` file in the consumer or producer folder.

Meter Simulator (producer) configurations:
- Meter id to identify the simulator
- Photofoltaic ID to identify to which pv system simulator is assigned a meter
- Building type to simulate
- Time intervals for data generation
- Value ranges and baseline for household consumption

PV simulator (consumer) configurations:
- Photovoltaic ID to identify the simulator
- Gaussian distribution parameters for photovoltaic production simulation


## 📊 Results Analysis

To visualize simulation results:

1. Wait for the simulation to generate some data
2. Identify the CSV file in the `data/` folder
3. Run the visualization script:
```bash
python plot_energy_data.py 
```
4. It will be prompted to insert the name of the file with data tho be shown. Write its the path from `data/` folder


## 📊 Monitoring

RabbitMQ Management: http://localhost:15672

User: guest
Password: guest

## 🔧 Extensibility

Thanks to the Factory Method pattern implemented in the meter simulator, new building types can be easily added:
- Create a new class that implements the MeterSimulator interface
- Add configuration in `config.py`
- The system will automatically handle the new simulation type

## 📝 Technical Notes

- CSV files names are generated with epoch timestamps to ensure uniqueness
- Asynchronous communication ensures resilience and scalability
- Docker volumes persist data even after container shutdown
- Modular architecture facilitates maintenance and testing

## 🔄 Simulation Flow

1. **Meter Simulator** generates household consumption data every 2 seconds (or the interval specified in the configurations)
2. Data is sent to **RabbitMQ broker** via asynchronous messaging
3. **PV Simulator** receives consumption data and generates corresponding solar production
4. Net energy balance is calculated and saved to timestamped CSV files
5. Results can be visualized using the provided plotting script

## 📋 File Structure

```
├── docker-compose.yml
├── consumer/
    ├── config.py
    ├── consumer.py
    ├── Dockerfile
    ├── pv_simulator.py
    ├── requirements.txt
├── producer/
    ├── config.py
    ├── Dockerfile
    ├── producer.py
    ├── requirements.txt 
    ├── meter
        ├── meter_simulator_factory.py
        ├── meter_simulator.py
        ├── residential_meter_simulator.py
├── data/                                           # CSV output files (Automatically generated)
    ├── <PV_ID>                                     # Automatically generated
        ├── energy_data_<timestamp_epoch_s>.csv     # Automatically generated
        ...
├── plot_energy_data.py
└── README.md
```